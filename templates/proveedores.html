{% extends "base.html" %} {% block title %}Proveedores{% endblock %} {% block
head %} {{ super() }}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/Clientes.css') }}"
/>
{% endblock %} {% block content %} {% include 'header.html' %} {% include
'sidebar.html' %}
<main>
  <div class="container_clientes">
    <h1>Proveedores</h1>
    <div class="container_clientes_buscar">
      <input
        type="text"
        placeholder="Buscar"
        oninput="filtrarProveedores(this.value)"
      />
      <button onclick="mostrarFormulario()">Añadir proveedor</button>
      <a href="{{ url_for('realizar_venta') }}"
        ><button class="Realizar_venta">Realizar compra</button></a
      >
      <button class="Actualizar" onclick="abrirModalActualizar()">
        Actualizar
      </button>
      <button class="Eliminar" onclick="eliminarProveedores()">Eliminar</button>
    </div>
    <div class="clientes">
      <table class="table_de_clientes">
        <thead>
          <tr>
            <th><input type="checkbox" id="select-all" /></th>
            <th>ID</th>
            <th>Nombre</th>
            <th>Dirección</th>
            <th>RIF</th>
          </tr>
        </thead>
        <tbody id="proveedores-table-body">
          <!-- Aquí se mostrarán los datos de los proveedores -->
          {% for proveedor in proveedores %}
          <tr>
            <td>
              <input
                type="checkbox"
                class="proveedor-checkbox"
                data-id="{{ proveedor.id }}"
              />
            </td>
            <td>{{ proveedor.id }}</td>
            <td>{{ proveedor.nombre }}</td>
            <td>{{ proveedor.direccion }}</td>
            <td>{{ proveedor.rif }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</main>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/component.js') }}"></script>
<script>
  function validarNumero(event) {
    // Permitir: backspace, delete, tab, escape, enter y .
    if (
      ["Backspace", "Delete", "Tab", "Escape", "Enter", "."].indexOf(
        event.key,
      ) !== -1 ||
      ((event.ctrlKey || event.metaKey) &&
        ["a", "c", "v", "x"].indexOf(event.key) !== -1) ||
      ["ArrowLeft", "ArrowRight", "ArrowUp", "ArrowDown"].indexOf(event.key) !==
        -1
    ) {
      return true;
    }
    // Asegurarse de que es un número
    if (!/^[0-9]$/.test(event.key)) {
      event.preventDefault();
      return false;
    }
    return true;
  }

  function mostrarFormulario() {
    document.getElementById("modal").style.display = "block";
  }

  function cerrarFormulario() {
    document.getElementById("modal").style.display = "none";
    limpiarCampos();
  }

  function limpiarCampos() {
    document.getElementById("formulario").reset();
  }

  function eliminarProveedores() {
    const ids = obtenerProveedoresSeleccionados();
    if (ids.length === 0) {
      alert("Seleccione al menos un proveedor para eliminar.");
      return;
    }

    const confirmacion = confirm(
      "¿Está seguro de que desea eliminar los proveedores seleccionados?",
    );
    if (!confirmacion) {
      return;
    }

    const form = document.createElement("form");
    form.method = "POST";
    form.action = "{{ url_for('eliminar_proveedores') }}";

    ids.forEach((id) => {
      const input = document.createElement("input");
      input.type = "hidden";
      input.name = "proveedor_ids";
      input.value = id;
      form.appendChild(input);
    });

    document.body.appendChild(form);
    form.submit();
  }

  const selectAllCheckbox = document.getElementById("select-all");
  const checkboxes = document.querySelectorAll(".proveedor-checkbox");

  selectAllCheckbox.addEventListener("change", function () {
    checkboxes.forEach(function (checkbox) {
      checkbox.checked = selectAllCheckbox.checked;
    });
  });
  function obtenerProveedoresSeleccionados() {
    const checkboxes = document.querySelectorAll(".proveedor-checkbox:checked");
    const ids = Array.from(checkboxes).map((checkbox) =>
      checkbox.getAttribute("data-id"),
    );
    return ids;
  }

  function abrirModalActualizar() {
    const filaSeleccionada = document
      .querySelector("input.proveedor-checkbox:checked")
      .closest("tr");

    const proveedorId = filaSeleccionada.cells[1].textContent;

    document.getElementById("proveedor_id_actualizar").value = proveedorId;

    const nombre = filaSeleccionada.cells[2].textContent;
    const direccion = filaSeleccionada.cells[3].textContent;
    const rif = filaSeleccionada.cells[4].textContent;

    document.getElementById("nombre_actualizar").value = nombre;
    document.getElementById("direccion_actualizar").value = direccion;
    document.getElementById("rif_actualizar").value = rif;

    document.getElementById("modal-actualizar").style.display = "block";
  }

  function cerrarModalActualizar() {
    document.getElementById("modal-actualizar").style.display = "none";
  }

  function filtrarProveedores(texto) {
    const filas = document.querySelectorAll(".table_de_clientes tbody tr");

    filas.forEach((fila) => {
      const contenido = fila.textContent.toLowerCase();
      if (contenido.includes(texto.toLowerCase())) {
        fila.style.display = "table-row";
      } else {
        fila.style.display = "none";
      }
    });
  }
</script>
{% endblock %}
